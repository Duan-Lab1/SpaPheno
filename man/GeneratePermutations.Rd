% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GeneratePermutations.R
\name{GeneratePermutations}
\alias{GeneratePermutations}
\title{Generate Permutation Scores for Model Significance Testing}
\usage{
GeneratePermutations(
  model,
  resolution = c("spot", "single_cell"),
  coordinate = NULL,
  family = c("cox", "binomial", "gaussian"),
  r = 2,
  k = 50,
  n = 50,
  seed = 2025,
  sample_information_decon = NULL,
  sample_information_cellType = NULL
)
}
\arguments{
\item{model}{A fitted glmnet model object, typically from \code{cv.glmnet()}, containing \code{model} and \code{lambda}.}

\item{resolution}{Character; one of \code{"spot"} or \code{"single_cell"}.}

\item{coordinate}{A matrix or data.frame of spatial coordinates. Row names must match spot or cell IDs.}

\item{family}{Character; glmnet family used for prediction (\code{"cox"}, \code{"binomial"}, or \code{"gaussian"}).}

\item{r}{Numeric; radius for neighborhood definition (used for \code{"spot"}). Default is 2.}

\item{k}{Integer; number of neighbors (used for \code{"single_cell"}). Default is 50.}

\item{n}{Integer; number of permutations to run. Default is 50.}

\item{seed}{Integer; random seed for reproducibility. Default is 2025.}

\item{sample_information_decon}{A list of spot-level cell type proportions (only used if \code{resolution = "spot"}). Each entry is a data.frame with rows as spots and columns as cell types.}

\item{sample_information_cellType}{A list of single-cell annotations (only used if \code{resolution = "single_cell"}). Each entry is a character vector of cell types.}
}
\value{
A numeric vector of predicted phenotype scores from each permutation replicate.
}
\description{
Generates phenotype prediction scores based on permuted spatial coordinates,
enabling permutation-based significance testing of spatial features in glmnet models.
}
\details{
This function permutes the row names of the coordinate matrix to shuffle spatial positions,
recalculates the local cell type neighborhood features via \code{Cell_type_neighborhood()},
and predicts phenotype scores using the input glmnet model.
The process is repeated \code{n} times to generate a null distribution of prediction scores.

The function relies on:
\itemize{
  \item \code{sample_information_decon}: global matrix of cell type proportions (for spot mode).
  \item \code{sample_information_cellType}: global named vector of cell types (for single-cell mode).
}
}
\examples{
\dontrun{

data("osmFISH_bulk_decon")
data("osmFISH_bulk_pheno")
data("osmFISH_bulk_coordinate")

model <- BuildPhenoModelAutoAlpha(
  expr = osmFISH_bulk_decon,
  pheno = osmFISH_bulk_pheno,
  family = "binomial")

data("osmFISH_metadata_cellType")
perm_scores <- GeneratePermutations(
  model = model,
  resolution = "single_cell",
  coordinate = osmFISH_bulk_coordinate,
  family = "binomial",
  r = 2,
  n = 100,
  sample_information_cellType = osmFISH_metadata_cellType
)
hist(perm_scores, breaks = 20, main = "Permutation Null Distribution")
}

}
\author{
Bin Duan
}
